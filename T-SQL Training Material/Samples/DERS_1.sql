

-- MODULE 1.1
-- DATA DEFINITION LANGUAGE

--USE Northwind


USE MyCompany

----- DATABASE

--with default setting
CREATE DATABASE SampleDatabase

CREATE DATABASE SampleDatabase
ON 
(
	name = 'BackDatabaseName',
	filename = 'D:\SampleDatabase.mdf',
	size = 5, -- MB
	filegrowth = 3 -- MB
)


ALTER DATABASE SampleDatabase
MODIFY FILE 
(
	name = 'BackDatabaseName',
	size = 15, -- MB
	filegrowth = 13 -- MB
)


DROP DATABASE SampleDatabase
go


----------- TABLE

USE SampleDatabase

CREATE TABLE SampleTable 
(
	Kolon1 int,
	Kolon2 nvarchar(max),
	Kolon3 float
)



CREATE TABLE SampleTable1 
(
	Id int Primary Key  IDENTITY(1,1),
	Kolon1 int,
	Kolon2 nvarchar(max),
	Kolon3 float
)


ALTER TABLE SampleTable1
ADD Kolon4 nvarchar(max)


ALTER TABLE SampleTable1
ADD Kolon5 nvarchar(max), Kolon6 nvarchar(max);


ALTER TABLE SampleTable1
ALTER COLUMN Kolon4 int


ALTER TABLE SampleTable1
DROP COLUMN Kolon4


--EXEC sp_rename 'SampleTable','SampleTableNew'
--EXECUTE sp_rename 'SampleTableNew','SampleTableNew1'

--EXEC sp_rename 'SampleTableNew1.Kolon1','KolonNewName','Column'


EXEC('SELECT * FROM SampleTable')

--DROP TABLE SampleTable1

--TRUNCATE TABLE SampleTable


--- GO
--go
--select * from SampleTable(NOLOCK)
--go 7



----------------- CONSTRAINT

CREATE TABLE NEWTABLE
(
	ID INT PRIMARY KEY IDENTITY(1,1),
	[NAME]  nvarchar(max),
	KOLON_1 nvarchar(100)
)


ALTER TABLE NEWTABLE
ADD KOLON_2 int

-- DEFAULT
ALTER TABLE NEWTABLE
ADD CONSTRAINT Kolon1Constraint DEFAULT '100' FOR KOLON_1

ALTER TABLE NEWTABLE
DROP CONSTRAINT Kolon1Constraint 

INSERT INTO NEWTABLE (NAME) VALUES ('YUNUS EMRE')

SELECT * FROM NEWTABLE(NOLOCK)

-- CHECK

ALTER TABLE NEWTABLE
ADD CONSTRAINT Kolon2Constraint CHECK ((KOLON_2 * 5) % 2 = 0)

INSERT INTO NEWTABLE (KOLON_2) VALUES (2)
SELECT * FROM NEWTABLE

INSERT INTO NEWTABLE (KOLON_2) VALUES (3)

ALTER TABLE NEWTABLE
WITH NOCHECK ADD CONSTRAINT Kolon2Constraint CHECK ((KOLON_2 * 5) % 2 = 0)



---- PRIMARY KEY

ALTER TABLE NEWTABLE
ADD CONSTRAINT PRIMARYKEY_ID PRIMARY KEY(ID)


---- UNIQUE Tekillik Sağlar

ALTER TABLE NEWTABLE
ADD CONSTRAINT UNIQUE_NAME UNIQUE (KOLON_1)

ALTER TABLE NEWTABLE
ADD CONSTRAINT UNIQUE_NAME1 UNIQUE (NAME)



----- FOREIGN KEY


CREATE TABLE STUDENTS
(
	ID INT PRIMARY KEY IDENTITY(1,1),
	LESSON_ID int,
	NAME nvarchar(50),
	SURNAME nvarchar(50)
)

CREATE TABLE LESSONS
(
	ID INT PRIMARY KEY IDENTITY(1,1),
	LESSON_NAME nvarchar(max)
)


ALTER TABLE STUDENTS
ADD CONSTRAINT  ForeignKeyConstraints FOREIGN KEY (LESSON_ID) REFERENCES LESSONS(ID)

ALTER TABLE STUDENTS
DROP CONSTRAINT ForeignKeyConstraints;

ALTER TABLE STUDENTS
ADD CONSTRAINT  ForeignKeyConstraints FOREIGN KEY (LESSON_ID) REFERENCES LESSONS(ID)
ON DELETE CASCADE
ON UPDATE CASCADE

ALTER TABLE STUDENTS
DROP CONSTRAINT ForeignKeyConstraints;

ALTER TABLE STUDENTS
ADD CONSTRAINT  ForeignKeyConstraints FOREIGN KEY (LESSON_ID) REFERENCES LESSONS(ID)
ON DELETE SET NULL
ON UPDATE SET NULL

ALTER TABLE STUDENTS
DROP CONSTRAINT ForeignKeyConstraints;

ALTER TABLE STUDENTS
ADD CONSTRAINT  ForeignKeyConstraints FOREIGN KEY (LESSON_ID) REFERENCES LESSONS(ID)
ON DELETE SET DEFAULT
ON UPDATE SET DEFAULT



---- SCHEMAS
GO
CREATE SCHEMA TEST
CREATE TABLE TEST.CATEGORIES 
(
	ID INT PRIMARY KEY IDENTITY(1,1),
	CATEGORY_NAME NVARCHAR(50)
)
GO

DROP TABLE TEST.CATEGORIES
DROP SCHEMA TEST

CREATE SCHEMA CORE

ALTER SCHEMA CORE
TRANSFER TEST.CATEGORIES



------ BACKUP-RESTORE DATABASE

